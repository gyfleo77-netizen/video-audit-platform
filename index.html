<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘æ™ºèƒ½å®¡æ ¸åˆ†æå¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        html, body {
            height: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: url('https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExcDNpMzduOXViODJteTEyNG53M2drMDlpNWhmcG9uZzBxNm9peWthOSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/xUA7b3mdJsdGrzF6dW/giphy.gif') center/cover no-repeat fixed;
            color: var(--dark);
            position: relative;
        }
        
        /* æ·»åŠ åŠé€æ˜é®ç½©å±‚ */
        html::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(99, 102, 241, 0.15);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInDown 0.6s ease;
            flex-shrink: 0;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 20px;
            animation: fadeIn 0.8s ease;
            flex: 1;
            overflow: hidden;
        }

        .sidebar, .main-content {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-lg);
            max-height: 100%; 
            overflow-y: auto;
        }

        .sidebar::-webkit-scrollbar {
            width: 8px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: var(--light);
            border-radius: 4px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .sidebar h3 {
            color: var(--primary);
            font-size: 1.1rem;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sidebar-section {
            margin-bottom: 24px;
        }

        /* Form Controls */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--dark);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.5);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-textarea {
            resize: vertical;
            font-family: inherit;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            font-size: 0.95rem;
            cursor: pointer;
            user-select: none;
        }

        /* Slider */
        .slider-group {
            margin-bottom: 16px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .slider-value {
            color: var(--primary);
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, var(--primary) 0%, var(--secondary) 100%);
            outline: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: white;
            border-color: var(--primary);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-block {
            width: 100%;
            margin-top: 8px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        /* File List */
        .file-list {
            margin-top: 12px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--light);
            border-radius: 6px;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .file-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Main Content */
        .main-content {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            box-shadow: var(--shadow-lg);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--border);
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            color: #64748b;
            transition: all 0.3s ease;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        /* Upload Area */
        .upload-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .upload-box {
            border: 3px dashed var(--border);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: rgba(248, 250, 252, 0.5);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-box:hover {
            border-color: var(--primary);
            background: rgba(239, 246, 255, 0.65);
        }

        .upload-box.dragover {
            border-color: var(--primary);
            background: rgba(239, 246, 255, 0.65);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 16px;
        }

        .upload-text {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .upload-hint {
            font-size: 0.9rem;
            color: #64748b;
        }

        .url-input-group {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .url-input-group input {
            flex: 1;
        }

        /* Video Preview */
        .video-preview {
            margin-top: 20px;
            border-radius: 12px;
            overflow: hidden;
            background: black;
        }

        .video-preview video {
            width: 100%;
            display: block;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 24px;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.95rem;
            opacity: 0.95;
        }

        /* Report Section */
        .report-section {
            background: rgba(248, 250, 252, 0.5);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .report-text {
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            background: rgba(255, 255, 255, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border);
            max-height: 500px;
            overflow-y: auto;
        }

        /* Scene Cards */
        .scene-card {
            background: rgba(255, 255, 255, 0.7);
            border-left: 4px solid var(--primary);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .scene-card:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow-lg);
        }

        .scene-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .scene-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .scene-badges {
            display: flex;
            gap: 8px;
        }

        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-primary {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .scene-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .scene-text {
            background: rgba(248, 250, 252, 0.7);
            padding: 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            line-height: 1.6;
            min-height: 100px;
        }

        /* Progress */
        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            transition: width 0.3s ease;
        }

        .progress-text {
            margin-top: 8px;
            font-size: 0.9rem;
            color: #64748b;
            text-align: center;
        }

        /* Alerts */
        .alert {
            padding: 16px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid var(--success);
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border-left: 4px solid var(--warning);
        }

        /* Divider */
        .divider {
            height: 1px;
            background: var(--border);
            margin: 20px 0;
        }

        /* Collapsible */
        .collapsible {
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 16px;
            overflow: hidden;
        }

        .collapsible-header {
            padding: 16px 20px;
            background: rgba(248, 250, 252, 0.6);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .collapsible-header:hover {
            background: #e2e8f0;
        }

        .collapsible-content {
            padding: 20px;
            display: none;
        }

        .collapsible-content.active {
            display: block;
        }
        .report-text ul, .report-text ol,
        .scene-text ul, .scene-text ol,
        #tab-help ul, #tab-help ol {
            /* ä¸ºåˆ—è¡¨æ¢å¤å·¦å†…è¾¹è·ï¼Œè¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ */
            padding-left: 40px; 
            margin-bottom: 16px; 
        }

        .report-text li,
        .scene-text li,
        #tab-help li {
            /* å¢åŠ åˆ—è¡¨é¡¹ä¹‹é—´çš„å‚ç›´é—´è·ï¼Œæå‡å¯è¯»æ€§ */
            margin-bottom: 8px; 
        }

        .report-text blockquote,
        .scene-text blockquote,
        #tab-help blockquote {
            /* ä¸º Markdown å¼•ç”¨ > æ¢å¤æ ·å¼ */
            margin-left: 0;
            padding-left: 15px;
            border-left: 3px solid var(--border);
            color: #64748b;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 280px 1fr;
            }
        }

        @media (max-width: 992px) {
            html, body {
                overflow: auto; /* æˆ–è€… overflow-y: auto; */
            }
            .main-layout {
                grid-template-columns: 1fr;
                overflow: visible;
                height: auto;
            }

            .sidebar, .main-content {
                max-height: none;
                overflow-y: visible;
            }

            .upload-section {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .scene-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 576px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-content {
            text-align: center;
            color: white;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .two-cols {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ¬ è§†é¢‘æ™ºèƒ½å®¡æ ¸åˆ†æå¹³å°</h1>
            <p>åŸºäºåœºæ™¯æ™ºèƒ½åˆ‡åˆ†çš„è§†é¢‘å†…å®¹ç†è§£ä¸å®¡æ ¸ç³»ç»Ÿ</p>
        </div>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3>âš™ï¸ æ¨¡å‹é…ç½®</h3>
                    <div class="form-group">
                        <label class="form-label">æ¨¡å‹è·¯å¾„</label>
                        <input type="text" class="form-input" id="modelPath" value="./models/MiniCPM-V-4_5">
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="useQuant">
                        <label for="useQuant">ä½¿ç”¨ 4bit é‡åŒ–</label>
                    </div>
                </div>

                <div class="divider"></div>

                <div class="sidebar-section">
                    <h3>ğŸ¯ åœºæ™¯æ£€æµ‹</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="useSceneDetection" checked>
                        <label for="useSceneDetection">å¯ç”¨æ™ºèƒ½åœºæ™¯åˆ‡åˆ†</label>
                    </div>
                    <div id="sceneDetectionOptions">
                        <div class="checkbox-group">
                            <input type="checkbox" id="useAdaptive">
                            <label for="useAdaptive">ä½¿ç”¨è‡ªé€‚åº”æ£€æµ‹å™¨</label>
                        </div>
                        <div class="slider-group" id="thresholdSlider">
                            <div class="slider-label">
                                <span>æ£€æµ‹é˜ˆå€¼</span>
                                <span class="slider-value" id="thresholdValue">27.0</span>
                            </div>
                            <input type="range" min="15" max="40" step="1" value="27" id="sceneThreshold">
                        </div>
                    </div>
                </div>

                <div class="divider"></div>

                <div class="sidebar-section">
                    <h3>ğŸï¸ æŠ½å¸§å‚æ•°</h3>
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>æŠ½å¸§ FPS</span>
                            <span class="slider-value" id="fpsValue">1.5</span>
                        </div>
                        <input type="range" min="0.5" max="5" step="0.1" value="1.5" id="chooseFps">
                    </div>
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>æœ€é•¿è¾¹ (px)</span>
                            <span class="slider-value" id="maxSideValue">512</span>
                        </div>
                        <input type="range" min="320" max="1024" step="32" value="512" id="maxSide">
                    </div>
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>Time Scale (s)</span>
                            <span class="slider-value" id="timeScaleValue">0.10</span>
                        </div>
                        <input type="range" min="0.05" max="0.5" step="0.05" value="0.1" id="timeScale">
                    </div>
                </div>

                <div class="divider"></div>

                <div class="sidebar-section">
                    <h3>ğŸ’¬ åˆ†ææç¤ºè¯</h3>
                    <div class="form-group">
                        <textarea class="form-textarea" id="promptText" rows="6">è¯·åˆ†æè¿™ä¸ªåœºæ™¯å¹¶è¾“å‡ºï¼š
1) åœºæ™¯ä¸äººç‰©ï¼ˆå¦‚æœ‰æœªæˆå¹´äººè¯·æ ‡æ˜ï¼‰
2) å…³é”®åŠ¨ä½œä¸äº‹ä»¶ï¼ˆæŒ‰æ—¶é—´é¡ºåºæè¿°ï¼‰
3) æ½œåœ¨é£é™©ç‚¹ï¼ˆå¦‚è¡€è…¥ã€æš´åŠ›ã€è‰²æƒ…ã€æ¶‰æ”¿ç­‰ï¼Œéœ€æ³¨æ˜æ—¶é—´ç‚¹ï¼‰
è¯·ç¡®ä¿ç»“æ„æ¸…æ™°ï¼Œæ€»å­—æ•°ä¸è¶…è¿‡ 150 å­—ã€‚</textarea>
                    </div>
                </div>

                <div class="divider"></div>

                <div class="sidebar-section">
                    <h3>ğŸ¤ è¯­éŸ³è¯†åˆ«</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="enableAsr" checked>
                        <label for="enableAsr">å¯ç”¨ Whisper ASR</label>
                    </div>
                    <div id="asrOptions">
                        <div class="form-group">
                            <label class="form-label">æ¨¡å‹ç›®å½•</label>
                            <input type="text" class="form-input" id="asrModel" value="./models/faster-whisper-base">
                        </div>
                        <div class="two-cols">
                            <div class="form-group">
                                <label class="form-label">è®¡ç®—ç±»å‹</label>
                                <select class="form-select" id="asrComputeType">
                                    <option value="int8_float16" selected>int8_float16</option>
                                    <option value="float16">float16</option>
                                    <option value="int8">int8</option>
                                    <option value="int8_float32">int8_float32</option>
                                    <option value="float32">float32</option>
                                </select>
                            </div>
                            <div class="slider-group">
                                <div class="slider-label">
                                    <span>Beam Size</span>
                                    <span class="slider-value" id="beamSizeValue">5</span>
                                </div>
                                <input type="range" min="1" max="10" step="1" value="5" id="asrBeamSize">
                            </div>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="asrVad" checked>
                            <label for="asrVad">VAD è¿‡æ»¤</label>
                        </div>
                        <div class="form-group">
                            <label class="form-label">è¯­è¨€ä»£ç </label>
                            <input type="text" class="form-input" id="asrLanguage" placeholder="ç•™ç©ºè‡ªåŠ¨æ£€æµ‹">
                        </div>
                        <div class="slider-group">
                            <div class="slider-label">
                                <span>æ¯åœºæ™¯æœ€å¤§å­—ç¬¦</span>
                                <span class="slider-value" id="asrMaxCharsValue">1200</span>
                            </div>
                            <input type="range" min="300" max="4000" step="100" value="1200" id="asrMaxChars">
                        </div>
                    </div>
                </div>

                <div class="divider"></div>

                <div class="sidebar-section">
                    <h3>ğŸ“ æ–‡ä»¶ç®¡ç†</h3>
                    <div class="file-list" id="fileList">
                        <p style="color: #64748b; font-size: 0.9rem;">æš‚æ— å·²ä¸‹è½½çš„è§†é¢‘æ–‡ä»¶</p>
                    </div>
                    <button class="btn btn-secondary btn-block btn-sm" id="clearFiles">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶</button>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Tabs -->
                <div class="tabs">
                    <button class="tab active" data-tab="input">ğŸ“¤ è§†é¢‘è¾“å…¥</button>
                    <button class="tab" data-tab="results">ğŸ“Š åˆ†æç»“æœ</button>
                    <button class="tab" data-tab="help">â„¹ï¸ ä½¿ç”¨è¯´æ˜</button>
                </div>

                <!-- Tab: Video Input -->
                <div class="tab-content active" id="tab-input">
                    <div class="upload-section">
                        <div>
                            <h3 style="margin-bottom: 16px;">ğŸ“ æœ¬åœ°è§†é¢‘ä¸Šä¼ </h3>
                            <div class="upload-box" id="uploadBox">
                                <div class="upload-icon">ğŸ“¹</div>
                                <div class="upload-text">æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </div>
                                <div class="upload-hint">æ”¯æŒ MP4, MOV, MKV, AVI æ ¼å¼</div>
                                <input type="file" id="fileInput" accept="video/*" style="display: none;">
                            </div>
                            <div id="videoPreview" class="video-preview" style="display: none;">
                                <video id="videoPlayer" controls></video>
                            </div>
                        </div>

                        <div>
                            <h3 style="margin-bottom: 16px;">ğŸŒ åœ¨çº¿è§†é¢‘ä¸‹è½½</h3>
                            <div class="upload-box" style="cursor: default;">
                                <div class="upload-icon">ğŸ”—</div>
                                <div class="upload-text">è¾“å…¥è§†é¢‘é“¾æ¥</div>
                                <div class="upload-hint">æ”¯æŒ YouTube, Bilibili ç­‰ä¸»æµå¹³å°</div>
                                <div class="url-input-group">
                                    <input type="text" class="form-input" id="videoUrl" placeholder="https://example.com/video.mp4">
                                    <button class="btn btn-primary" id="downloadBtn">â¬‡ï¸ ä¸‹è½½</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary btn-block" id="analyzeBtn" style="font-size: 1.1rem; padding: 16px;">
                        ğŸš€ å¼€å§‹æ™ºèƒ½åˆ†æ
                    </button>
                </div>

                <!-- Tab: Results -->
                <div class="tab-content" id="tab-results">
                    <div class="alert alert-info" id="noResultsAlert">
                        <span>â„¹ï¸</span>
                        <span>è¯·å…ˆåœ¨ã€Œè§†é¢‘è¾“å…¥ã€æ ‡ç­¾é¡µä¸Šä¼ è§†é¢‘å¹¶ç‚¹å‡»ã€Œå¼€å§‹æ™ºèƒ½åˆ†æã€</span>
                    </div>

                    <div id="resultsContent" style="display: none;">
                        <!-- Stats -->
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="statScenes">5</div>
                                <div class="stat-label">æ£€æµ‹åœºæ™¯</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="statFrames">30</div>
                                <div class="stat-label">é‡‡æ ·å¸§æ•°</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="statDuration">60.5s</div>
                                <div class="stat-label">è§†é¢‘æ—¶é•¿</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="statFps">29.97</div>
                                <div class="stat-label">è§†é¢‘å¸§ç‡</div>
                            </div>
                        </div>

                        <!-- Report -->
                        <div class="report-section">
                            <h3 style="margin-bottom: 16px;">ğŸ“„ å®Œæ•´åˆ†ææŠ¥å‘Š</h3>
                            <div class="report-text" id="reportText">ã€MiniCPM-V 4.5 Â· è§†é¢‘åœºæ™¯æ™ºèƒ½åˆ‡åˆ†å®¡æ ¸æŠ¥å‘Šã€‘

ğŸ“Š åŸºç¡€ä¿¡æ¯
- è§†é¢‘å¸§ç‡: 29.97 fps
- è§†é¢‘æ—¶é•¿: 60.52 ç§’
- æ£€æµ‹åœºæ™¯: 5 ä¸ª
- é‡‡æ ·å¸§æ•°: 30 å¸§
- è¯»å–æ–¹æ³•: decord

âš ï¸ é£é™©è¯„ä¼°
æœªå‘ç°æ˜æ˜¾è¿è§„å†…å®¹

ğŸ“‹ åœºæ™¯æ¦‚è§ˆ
1. åœºæ™¯1 (0.00s - 12.10s): å®¤å†…åœºæ™¯ï¼Œä¸»è¦äººç‰©æ´»åŠ¨
2. åœºæ™¯2 (12.10s - 24.50s): åœºæ™¯åˆ‡æ¢ï¼Œæˆ·å¤–ç¯å¢ƒ
3. åœºæ™¯3 (24.50s - 38.20s): å¯¹è¯åœºæ™¯
4. åœºæ™¯4 (38.20s - 50.00s): åŠ¨ä½œåœºæ™¯
5. åœºæ™¯5 (50.00s - 60.52s): ç»“å°¾åœºæ™¯

âœ… å®¡æ ¸ç»“è®ºï¼šé€šè¿‡</div>
                            <div style="display: flex; gap: 12px; margin-top: 16px;">
                                <button class="btn btn-primary" id="downloadJson">ğŸ’¾ ä¸‹è½½ JSON æŠ¥å‘Š</button>
                                <button class="btn btn-secondary" id="downloadTxt">ğŸ“ ä¸‹è½½ TXT æŠ¥å‘Š</button>
                            </div>
                        </div>

                        <!-- ASR Transcript -->
                        <div class="collapsible">
                            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                                <span>ğŸ¤ å®Œæ•´è¯­éŸ³è½¬å†™</span>
                                <span>â–¼</span>
                            </div>
                            <div class="collapsible-content">
                                <div class="report-text" id="transcriptText">è¿™æ˜¯æ¨¡æ‹Ÿçš„å…¨æ–‡è¯­éŸ³è½¬å†™ç»“æœã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ˜¾ç¤º Whisper æ¨¡å‹å¯¹æ•´ä¸ªè§†é¢‘çš„å®Œæ•´è½¬å†™å†…å®¹ï¼ŒåŒ…æ‹¬æ—¶é—´æˆ³å’Œè¯´è¯äººä¿¡æ¯...</div>
                            </div>
                        </div>

                        <!-- Scene Details -->
                        <div class="collapsible">
                            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                                <span>ğŸ¬ åœºæ™¯è¯¦ç»†åˆ†æ</span>
                                <span>â–¼</span>
                            </div>
                            <div class="collapsible-content active">
                                <div id="sceneDetails"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab: Help -->
                <div class="tab-content" id="tab-help">
                    <div style="line-height: 1.8;">
                        <h2 style="color: var(--primary); margin-bottom: 20px;">ğŸ“– ç³»ç»ŸåŠŸèƒ½</h2>
                        <p>æœ¬ç³»ç»ŸåŸºäº <strong>MiniCPM-V 4.5</strong> è§†è§‰è¯­è¨€æ¨¡å‹ï¼Œæä¾›æ™ºèƒ½åŒ–çš„è§†é¢‘å†…å®¹ç†è§£ä¸å®¡æ ¸èƒ½åŠ›ã€‚</p>

                        <h3 style="color: var(--primary); margin-top: 30px; margin-bottom: 16px;">âœ¨ æ ¸å¿ƒç‰¹æ€§</h3>
                        
                        <h4 style="margin-top: 20px; margin-bottom: 12px;">1. æ™ºèƒ½åœºæ™¯åˆ‡åˆ†</h4>
                        <ul style="margin-left: 20px; margin-bottom: 16px;">
                            <li>ğŸ¯ è‡ªåŠ¨è¯†åˆ«è§†é¢‘ä¸­çš„åœºæ™¯åˆ‡æ¢ç‚¹</li>
                            <li>ğŸ”§ æ”¯æŒä¸¤ç§æ£€æµ‹ç®—æ³•ï¼š
                                <ul style="margin-left: 20px; margin-top: 8px;">
                                    <li><strong>ContentDetector</strong>: é€‚ç”¨äºå¿«é€Ÿåˆ‡æ¢åœºæ™¯ï¼ˆå‰ªè¾‘è§†é¢‘ã€æ–°é—»ç­‰ï¼‰</li>
                                    <li><strong>AdaptiveDetector</strong>: é€‚ç”¨äºæ¸å˜åœºæ™¯ï¼ˆç”µå½±ã€çºªå½•ç‰‡ç­‰ï¼‰</li>
                                </ul>
                            </li>
                            <li>âš–ï¸ å¯è°ƒèŠ‚æ£€æµ‹çµæ•åº¦ï¼Œå¹³è¡¡æ£€æµ‹ç²¾åº¦ä¸åœºæ™¯æ•°é‡</li>
                        </ul>

                        <h4 style="margin-top: 20px; margin-bottom: 12px;">2. å¤šæ ¼å¼è§†é¢‘æ”¯æŒ</h4>
                        <ul style="margin-left: 20px; margin-bottom: 16px;">
                            <li>ğŸ¥ è‡ªåŠ¨æ£€æµ‹ç¼–ç æ ¼å¼ï¼ˆH264/AV1/VP9/HEVCï¼‰</li>
                            <li>ğŸ”„ ä¸å…¼å®¹æ ¼å¼è‡ªåŠ¨è½¬æ¢</li>
                            <li>ğŸ“¦ å¤šé‡è¯»å–æœºåˆ¶ç¡®ä¿æœ€å¤§å…¼å®¹æ€§</li>
                        </ul>

                        <h4 style="margin-top: 20px; margin-bottom: 12px;">3. è¯­éŸ³è¯†åˆ«ï¼ˆASRï¼‰</h4>
                        <ul style="margin-left: 20px; margin-bottom: 16px;">
                            <li>ğŸ—£ï¸ åŸºäº Faster-Whisper çš„é«˜æ•ˆè¯­éŸ³è½¬å†™</li>
                            <li>ğŸŒ æ”¯æŒå¤šè¯­è¨€è‡ªåŠ¨æ£€æµ‹</li>
                            <li>ğŸ¯ VAD è¿‡æ»¤æå‡è½¬å†™è´¨é‡</li>
                        </ul>

                        <h4 style="margin-top: 20px; margin-bottom: 12px;">4. åœ¨çº¿è§†é¢‘ä¸‹è½½</h4>
                        <ul style="margin-left: 20px; margin-bottom: 16px;">
                            <li>ğŸŒ æ”¯æŒ YouTubeã€Bilibili ç­‰ä¸»æµå¹³å°</li>
                            <li>âš¡ åŸºäº yt-dlp çš„å¼ºå¤§ä¸‹è½½èƒ½åŠ›</li>
                        </ul>

                        <div class="divider"></div>

                        <h3 style="color: var(--primary); margin-top: 30px; margin-bottom: 16px;">ğŸ”§ ä½¿ç”¨æµç¨‹</h3>

                        <h4 style="margin-top: 20px; margin-bottom: 12px;">æ­¥éª¤ 1: å‡†å¤‡è§†é¢‘</h4>
                        <ul style="margin-left: 20px; margin-bottom: 16px;">
                            <li>æ–¹å¼Aï¼šç‚¹å‡»ã€Œæœ¬åœ°è§†é¢‘ä¸Šä¼ ã€åŒºåŸŸä¸Šä¼ æ–‡ä»¶</li>
                            <li>æ–¹å¼Bï¼šåœ¨ã€Œåœ¨çº¿è§†é¢‘ä¸‹è½½ã€è¾“å…¥ URL å¹¶ç‚¹å‡»ä¸‹è½½</li>
                        </ul>

                        <h4 style="margin-top: 20px; margin-bottom: 12px;">æ­¥éª¤ 2: é…ç½®å‚æ•°</h4>
                        <p style="margin-left: 20px; margin-bottom: 16px;">åœ¨å·¦ä¾§è¾¹æ è°ƒæ•´å„é¡¹å‚æ•°ï¼š</p>
                        <ul style="margin-left: 40px; margin-bottom: 16px;">
                            <li>âš™ï¸ <strong>æ¨¡å‹é…ç½®</strong>: æ¨¡å‹è·¯å¾„ã€é‡åŒ–é€‰é¡¹</li>
                            <li>ğŸ¯ <strong>åœºæ™¯æ£€æµ‹</strong>: æ˜¯å¦å¯ç”¨ã€æ£€æµ‹ç®—æ³•ã€çµæ•åº¦</li>
                            <li>ğŸï¸ <strong>æŠ½å¸§å‚æ•°</strong>: FPSã€å›¾åƒå°ºå¯¸ã€æ—¶é—´ç¼©æ”¾</li>
                            <li>ğŸ’¬ <strong>æç¤ºè¯</strong>: è‡ªå®šä¹‰åˆ†æè¦æ±‚</li>
                            <li>ğŸ¤ <strong>è¯­éŸ³è¯†åˆ«</strong>: æ˜¯å¦å¯ç”¨ã€æ¨¡å‹é…ç½®</li>
                        </ul>

                        <h4 style="margin-top: 20px; margin-bottom: 12px;">æ­¥éª¤ 3: å¼€å§‹åˆ†æ</h4>
                        <ul style="margin-left: 20px; margin-bottom: 16px;">
                            <li>ç‚¹å‡»ã€ŒğŸš€ å¼€å§‹æ™ºèƒ½åˆ†æã€æŒ‰é’®</li>
                            <li>ç³»ç»Ÿå°†è‡ªåŠ¨å®Œæˆï¼šåœºæ™¯æ£€æµ‹ â†’ æŠ½å¸§ â†’ è¯­éŸ³è½¬å†™ â†’ å†…å®¹åˆ†æ</li>
                        </ul>

                        <h4 style="margin-top: 20px; margin-bottom: 12px;">æ­¥éª¤ 4: æŸ¥çœ‹ç»“æœ</h4>
                        <ul style="margin-left: 20px; margin-bottom: 16px;">
                            <li>åˆ‡æ¢åˆ°ã€ŒğŸ“Š åˆ†æç»“æœã€æ ‡ç­¾é¡µ</li>
                            <li>æŸ¥çœ‹ç»Ÿè®¡æ•°æ®ã€å®Œæ•´æŠ¥å‘Šã€åœºæ™¯è¯¦æƒ…</li>
                            <li>ä¸‹è½½ JSON/TXT æ ¼å¼æŠ¥å‘Š</li>
                        </ul>

                        <div class="divider"></div>

                        <h3 style="color: var(--primary); margin-top: 30px; margin-bottom: 16px;">âš™ï¸ å‚æ•°è¯´æ˜</h3>

                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                            <thead>
                                <tr style="background: var(--light);">
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border);">å‚æ•°</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border);">è¯´æ˜</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border);">æ¨èå€¼</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid var(--border);">åœºæ™¯æ£€æµ‹é˜ˆå€¼</td>
                                    <td style="padding: 12px; border: 1px solid var(--border);">æ•°å€¼è¶Šä½è¶Šæ•æ„Ÿ</td>
                                    <td style="padding: 12px; border: 1px solid var(--border);">25-30</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid var(--border);">æŠ½å¸§ FPS</td>
                                    <td style="padding: 12px; border: 1px solid var(--border);">æ¯ç§’é‡‡æ ·å¸§æ•°</td>
                                    <td style="padding: 12px; border: 1px solid var(--border);">1-2</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid var(--border);">å›¾åƒæœ€é•¿è¾¹</td>
                                    <td style="padding: 12px; border: 1px solid var(--border);">è¾“å…¥æ¨¡å‹çš„å›¾åƒå°ºå¯¸</td>
                                    <td style="padding: 12px; border: 1px solid var(--border);">512-768</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid var(--border);">Beam Size</td>
                                    <td style="padding: 12px; border: 1px solid var(--border);">ASR æœç´¢å®½åº¦</td>
                                    <td style="padding: 12px; border: 1px solid var(--border);">5</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="divider"></div>

                        <h3 style="color: var(--primary); margin-top: 30px; margin-bottom: 16px;">ğŸ’¡ æœ€ä½³å®è·µ</h3>

                        <div class="alert alert-success">
                            <span>âœ…</span>
                            <div>
                                <strong>å¿«èŠ‚å¥è§†é¢‘ï¼ˆå‰ªè¾‘ã€Vlogï¼‰</strong><br>
                                â€¢ ä½¿ç”¨ ContentDetector<br>
                                â€¢ é˜ˆå€¼è®¾ç½®ä¸º 20-25<br>
                                â€¢ æŠ½å¸§ FPS: 2-3
                            </div>
                        </div>

                        <div class="alert alert-success">
                            <span>âœ…</span>
                            <div>
                                <strong>ç”µå½±/çºªå½•ç‰‡</strong><br>
                                â€¢ ä½¿ç”¨ AdaptiveDetector<br>
                                â€¢ é˜ˆå€¼è®¾ç½®ä¸º 25-30<br>
                                â€¢ æŠ½å¸§ FPS: 1-1.5
                            </div>
                        </div>

                        <div class="alert alert-success">
                            <span>âœ…</span>
                            <div>
                                <strong>ç›‘æ§è§†é¢‘</strong><br>
                                â€¢ ç¦ç”¨åœºæ™¯æ£€æµ‹ï¼ˆä½œä¸ºå•ä¸€åœºæ™¯ï¼‰<br>
                                â€¢ æŠ½å¸§ FPS: 0.5-1
                            </div>
                        </div>

                        <div class="divider"></div>

                        <h3 style="color: var(--primary); margin-top: 30px; margin-bottom: 16px;">ğŸ› ï¸ æŠ€æœ¯æ¶æ„</h3>
                        <ul style="margin-left: 20px;">
                            <li><strong>è§†è§‰ç†è§£</strong>: MiniCPM-V 4.5</li>
                            <li><strong>åœºæ™¯æ£€æµ‹</strong>: PySceneDetect</li>
                            <li><strong>è¯­éŸ³è¯†åˆ«</strong>: Faster-Whisper</li>
                            <li><strong>è§†é¢‘å¤„ç†</strong>: Decord / OpenCV / MoviePy</li>
                            <li><strong>ä¸‹è½½å·¥å…·</strong>: yt-dlp</li>
                        </ul>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3 id="loadingText">æ­£åœ¨å¤„ç†...</h3>
        </div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€
        let uploadedFile = null;
        let downloadedServerFile = null;
        let downloadedFiles = [];
        let analysisResults = null;

        // Tab åˆ‡æ¢
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.dataset.tab;
                
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`tab-${targetTab}`).classList.add('active');
            });
        });

        // æ»‘å—å€¼æ›´æ–°
        function setupSlider(sliderId, valueId, formatter = (v) => v) {
            const slider = document.getElementById(sliderId);
            const valueDisplay = document.getElementById(valueId);
            slider.addEventListener('input', (e) => {
                valueDisplay.textContent = formatter(e.target.value);
            });
        }

        setupSlider('sceneThreshold', 'thresholdValue', v => parseFloat(v).toFixed(1));
        setupSlider('chooseFps', 'fpsValue', v => parseFloat(v).toFixed(1));
        setupSlider('maxSide', 'maxSideValue');
        setupSlider('timeScale', 'timeScaleValue', v => parseFloat(v).toFixed(2));
        setupSlider('asrBeamSize', 'beamSizeValue');
        setupSlider('asrMaxChars', 'asrMaxCharsValue');

        // åœºæ™¯æ£€æµ‹é€‰é¡¹æ˜¾ç¤º/éšè—
        document.getElementById('useSceneDetection').addEventListener('change', (e) => {
            document.getElementById('sceneDetectionOptions').style.display = 
                e.target.checked ? 'block' : 'none';
        });

        // è‡ªé€‚åº”æ£€æµ‹å™¨é€‰é¡¹
        document.getElementById('useAdaptive').addEventListener('change', (e) => {
            document.getElementById('thresholdSlider').style.display = 
                e.target.checked ? 'none' : 'block';
        });

        // ASRé€‰é¡¹æ˜¾ç¤º/éšè—
        document.getElementById('enableAsr').addEventListener('change', (e) => {
            document.getElementById('asrOptions').style.display = 
                e.target.checked ? 'block' : 'none';
        });

        // æ–‡ä»¶ä¸Šä¼ 
        const uploadBox = document.getElementById('uploadBox');
        const fileInput = document.getElementById('fileInput');
        const videoPreview = document.getElementById('videoPreview');
        const videoPlayer = document.getElementById('videoPlayer');

        uploadBox.addEventListener('click', () => fileInput.click());

        uploadBox.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadBox.classList.add('dragover');
        });

        uploadBox.addEventListener('dragleave', () => {
            uploadBox.classList.remove('dragover');
        });

        uploadBox.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadBox.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileUpload(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });

        function handleFileUpload(file) {
            if (!file.type.startsWith('video/')) {
                alert('è¯·ä¸Šä¼ è§†é¢‘æ–‡ä»¶ï¼');
                return;
            }
            uploadedFile = file;
            videoPlayer.src = URL.createObjectURL(file);
            videoPreview.style.display = 'block';
            showAlert('success', `âœ… å·²ä¸Šä¼ è§†é¢‘: ${file.name}`);
        }

        // URLä¸‹è½½
        // æ‰¾åˆ° downloadBtn çš„äº‹ä»¶ç›‘å¬å™¨å¹¶æ›¿æ¢å®ƒ

        document.getElementById('downloadBtn').addEventListener('click', async () => {
            const url = document.getElementById('videoUrl').value.trim();
            if (!url) {
                showAlert('warning', 'âš ï¸ è¯·è¾“å…¥è§†é¢‘é“¾æ¥');
                return;
            }

            showLoading('æ­£åœ¨è¯·æ±‚æœåŠ¡å™¨ä¸‹è½½è§†é¢‘...');
            
            try {
                const backendUrl = `http://${window.location.hostname}:5000/download`;
                const response = await fetch(backendUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url }), // å°† URL å‘é€ç»™åç«¯
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `ä¸‹è½½å¤±è´¥: ${response.status}`);
                }

                const result = await response.json();
                
                // **é‡è¦ï¼š** ç”¨ä¸€ä¸ªæ–°å˜é‡æ¥å­˜å‚¨æœåŠ¡å™¨è¿”å›çš„æ–‡ä»¶å
                downloadedServerFile = {
                    name: result.filename,
                    title: result.original_title
                };
                uploadedFile = null; // æ¸…é™¤æœ¬åœ°ä¸Šä¼ çš„æ–‡ä»¶ï¼Œç¡®ä¿ä¸€æ¬¡åªåˆ†æä¸€ä¸ª

                hideLoading();
                showAlert('success', `âœ… ä¸‹è½½æˆåŠŸ: ${result.filename}`);

                // æ›´æ–° UIï¼Œè®©ç”¨æˆ·çŸ¥é“å“ªä¸ªæ–‡ä»¶å‡†å¤‡å¥½è¢«åˆ†æäº†
                // (å¯ä»¥é«˜äº®æ˜¾ç¤ºæˆ–æ˜¯åœ¨é¢„è§ˆåŒºæ˜¾ç¤ºæ–‡ä»¶å)
                document.getElementById('uploadBox').innerHTML = `
                    <div class="upload-icon">âœ…</div>
                    <div class="upload-text">æ–‡ä»¶å·²å°±ç»ª</div>
                    <div class="upload-hint" style="word-break: break-all;">${result.filename}</div>`;
                videoPreview.style.display = 'none';


            } catch (error) {
                hideLoading();
                console.error('ä¸‹è½½å¤±è´¥:', error);
                showAlert('danger', `âŒ ä¸‹è½½å¤±è´¥: ${error.message}`);
            }
        });

        // æ–‡ä»¶åˆ—è¡¨ç®¡ç†
        function updateFileList() {
            const fileList = document.getElementById('fileList');
            if (downloadedFiles.length === 0) {
                fileList.innerHTML = '<p style="color: #64748b; font-size: 0.9rem;">æš‚æ— å·²ä¸‹è½½çš„è§†é¢‘æ–‡ä»¶</p>';
                return;
            }

            fileList.innerHTML = downloadedFiles.map((file, idx) => `
                <div class="file-item">
                    <span class="file-name">ğŸ“¹ ${file.name}</span>
                    <button class="btn btn-danger btn-sm" onclick="deleteFile(${idx})">ğŸ—‘ï¸</button>
                </div>
            `).join('');
        }

        function deleteFile(idx) {
            downloadedFiles.splice(idx, 1);
            updateFileList();
            showAlert('success', 'å·²åˆ é™¤æ–‡ä»¶');
        }

        document.getElementById('clearFiles').addEventListener('click', () => {
            downloadedFiles = [];
            updateFileList();
            showAlert('success', 'å·²æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶');
        });

        // å¼€å§‹åˆ†æ
        document.getElementById('analyzeBtn').addEventListener('click', async () => {
            if (!uploadedFile && !downloadedServerFile) {
                showAlert('warning', 'âš ï¸ è¯·å…ˆä¸Šä¼ ä¸€ä¸ªè§†é¢‘æˆ–ä»URLä¸‹è½½ä¸€ä¸ªè§†é¢‘ï¼');
                return;
            }

            showLoading('æ­£åœ¨ä¸Šä¼ å¹¶å¯åŠ¨åˆ†æ...');

            const formData = new FormData();
            
            // ã€æ ¸å¿ƒé€»è¾‘ã€‘åˆ¤æ–­æ˜¯ä¸Šä¼ æ–‡ä»¶ï¼Œè¿˜æ˜¯å‘é€å·²ä¸‹è½½çš„æ–‡ä»¶å
            if (uploadedFile) {
                formData.append('video', uploadedFile);
            } else {
                formData.append('filename', downloadedServerFile.name);
            }

            formData.append('video', uploadedFile);
            formData.append('useSceneDetection', document.getElementById('useSceneDetection').checked);
            formData.append('useAdaptive', document.getElementById('useAdaptive').checked);
            formData.append('sceneThreshold', document.getElementById('sceneThreshold').value);
            formData.append('chooseFps', document.getElementById('chooseFps').value);
            formData.append('maxSide', document.getElementById('maxSide').value);
            formData.append('timeScale', document.getElementById('timeScale').value);
            formData.append('promptText', document.getElementById('promptText').value);
            formData.append('enableAsr', document.getElementById('enableAsr').checked);
            formData.append('asrLanguage', document.getElementById('asrLanguage').value);
            formData.append('asrBeamSize', document.getElementById('asrBeamSize').value);
            formData.append('asrVad', document.getElementById('asrVad').checked);
            formData.append('asrMaxChars', document.getElementById('asrMaxChars').value);
            
            try {
                const backendUrl = `http://${window.location.hostname}:5000/analyze`;
                const response = await fetch(backendUrl, {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `æœåŠ¡å™¨è¿”å›é”™è¯¯: ${response.status}`);
                }

                const results = await response.json();
                
                hideLoading();
                updateResultsUI(results);
                document.querySelector('.tab[data-tab="results"]').click();
                showAlert('success', 'âœ… åˆ†æå®Œæˆï¼');

                // åˆ†æå®Œæˆåï¼Œé‡ç½®çŠ¶æ€
                uploadedFile = null;
                downloadedServerFile = null;

            } catch (error) {
                hideLoading();
                console.error('åˆ†æå¤±è´¥:', error);
                showAlert('danger', `âŒ åˆ†æå¤±è´¥: ${error.message}`);
            }
        });

        function updateResultsUI(data) {
            document.getElementById('noResultsAlert').style.display = 'none';
            document.getElementById('resultsContent').style.display = 'block';

            document.getElementById('statScenes').textContent = data.stats.scenes;
            document.getElementById('statFrames').textContent = data.stats.frames;
            document.getElementById('statDuration').textContent = data.stats.duration;
            document.getElementById('statFps').textContent = data.stats.fps;

            document.getElementById('reportText').innerHTML = marked.parse(data.report);
            document.getElementById('transcriptText').textContent = data.full_transcript || '(æ— å¯ç”¨è¯­éŸ³è½¬å†™)';

            const sceneDetailsContainer = document.getElementById('sceneDetails');
            sceneDetailsContainer.innerHTML = '';

            if (data.scene_details && data.scene_details.length > 0) {
                data.scene_details.forEach(scene => {
                    const sceneCard = document.createElement('div');
                    sceneCard.className = 'scene-card';
                    
                    const asrEnabled = document.getElementById('enableAsr').checked;
                    const transcriptHTML = asrEnabled ? `
                        <div>
                            <strong>ğŸ¤ è¯­éŸ³è½¬å†™</strong>
                            <div class="scene-text">${scene.transcript || '(æ­¤åœºæ™¯æ— è¯­éŸ³è½¬å†™)'}</div>
                        </div>` : '';

                    sceneCard.innerHTML = `
                        <div class="scene-header">
                            <div class="scene-title">${scene.title}</div>
                            <div class="scene-badges">
                                <span class="badge badge-primary">â±ï¸ ${scene.time}</span>
                                <span class="badge badge-success">âœ… æ­£å¸¸</span>
                            </div>
                        </div>
                        <div class="scene-content">
                            <div>
                                <strong>ğŸ¬ åœºæ™¯åˆ†æ</strong>
                                <div class="scene-text">${marked.parse(scene.analysis)}</div>
                            </div>
                            ${transcriptHTML}
                        </div>`;
                    
                    sceneDetailsContainer.appendChild(sceneCard);
                });
            } else {
                sceneDetailsContainer.innerHTML = '<p>æœªèƒ½ç”Ÿæˆåœºæ™¯è¯¦æƒ…ã€‚</p>';
            }
        }

        // æŠ˜å é¢æ¿
        function toggleCollapsible(header) {
            const content = header.nextElementSibling;
            const arrow = header.querySelector('span:last-child');
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                arrow.textContent = 'â–¼';
            } else {
                content.classList.add('active');
                arrow.textContent = 'â–²';
            }
        }

        // ä¸‹è½½æŠ¥å‘Š
        document.getElementById('downloadJson').addEventListener('click', () => {
            const data = {
                ok: true,
                report: document.getElementById('reportText').textContent,
                scenes: []
            };
            downloadFile(JSON.stringify(data, null, 2), `scene_report_${Date.now()}.json`, 'application/json');
        });

        document.getElementById('downloadTxt').addEventListener('click', () => {
            const text = document.getElementById('reportText').textContent;
            downloadFile(text, `scene_report_${Date.now()}.txt`, 'text/plain');
        });

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            showAlert('success', `âœ… å·²ä¸‹è½½: ${filename}`);
        }

        // å·¥å…·å‡½æ•°
        function showLoading(text) {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function updateLoadingText(text) {
            document.getElementById('loadingText').textContent = text;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function showAlert(type, message) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 10000; min-width: 300px; animation: fadeInDown 0.3s ease;';
            alert.innerHTML = `<span>${message}</span>`;
            document.body.appendChild(alert);

            setTimeout(() => {
                alert.style.animation = 'fadeIn 0.3s ease reverse';
                setTimeout(() => alert.remove(), 300);
            }, 3000);
        }

        // åˆå§‹åŒ–
        updateFileList();
    </script>
    <script src="./marked.min.js"></script>
</body>
</html>